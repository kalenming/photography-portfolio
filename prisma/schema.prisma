generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Photo {
  id            String   @id @default(uuid())
  title         String
  filename      String
  originalPath  String
  thumbnailPath String?
  width         Int
  height        Int
  fileSize      Int
  
  shotAt        DateTime?
  latitude      Float?
  longitude     Float?
  location      String?
  
  camera        String?
  lens          String?
  iso           Int?
  aperture      String?
  shutterSpeed  String?
  focalLength   String?
  
  description   String?
  
  year          Int
  month         Int
  day           Int
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  categories    PhotoCategory[]
  
  @@index([year])
  @@index([month])
  @@index([location])
  @@index([shotAt])
}

model Category {
  id        String   @id @default(uuid())
  name      String   @unique
  type      String
  count     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  photos    PhotoCategory[]
  
  @@index([type])
}

model PhotoCategory {
  photoId     String
  categoryId  String
  
  photo       Photo     @relation(fields: [photoId], references: [id], onDelete: Cascade)
  category    Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  
  @@id([photoId, categoryId])
}
